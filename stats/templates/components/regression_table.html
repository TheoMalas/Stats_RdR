 <style>

    table {
        border-collapse: collapse;
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
        margin-top: 20px;
        border: 1px solid #ccc;
    }

    caption {
        text-align: left;
        font-style: italic;
        font-size: 1.1em;
        margin-bottom: 10px;
    }

    th, td {
        padding: 8px 12px;
        text-align: left;
        vertical-align: top;
    }

    th {
        font-weight: bold;
        font-style: italic;
    }

    .footer {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        
        padding-top: 20px;
        font-size: 0.90em;
        
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
    }

    .stars {
        font-weight: bold;
    }
</style>

{% with "data_"|add:id as data_id %}
  {{ table_data|json_script:data_id }}
{% endwith %}

<table id="{{ id|safe }}">
  <thead>
    <tr>
      <th>Variable</th>
      <th class="coef">Coefficient</th>
      <th class="coef">(Erreur standard)</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>

<div class="footer">
  <div id="observations"></div>
  <div id="r2"></div>
  <div class="note">
    <em>Note :</em> <span class="stars">*</span>p&lt;0.1; <span class="stars">**</span>p&lt;0.05; <span class="stars">***</span>p&lt;0.01
  </div>
</div>

<script>
(function() {
    
    const data = JSON.parse(document.getElementById('data_{{ id }}').textContent);
    const tbody = document.querySelector(`#{{ id|safe }} tbody`);

    data.data.forEach(item => {
        const tr = document.createElement('tr');

        // Variable (texte)
        const tdVar = document.createElement('td');
        tdVar.textContent = item.variable;
        tr.appendChild(tdVar);

        // Coefficient (avec éventuelles étoiles)
        const tdCoef = document.createElement('td');
        const coefMatch = item.coefficient.match(/^([-+]?\d*\.?\d+)([*]{1,3})?$/);
        if (coefMatch) {
            tdCoef.innerHTML = coefMatch[1] + (coefMatch[2] ? `<span class="stars">${coefMatch[2]}</span>` : '');
        } else {
            tdCoef.textContent = item.coefficient;
        }
        tr.appendChild(tdCoef);

        // Erreur standard
        const tdSE = document.createElement('td');
        tdSE.textContent = `(${item.standard_error})`;
        tr.appendChild(tdSE);

        tbody.appendChild(tr);
    });

    document.getElementById('observations').textContent = `Observations : ${data.nb_observation}`;
    document.getElementById('r2').textContent = `R² : ${data.r_squared}`;
})();
</script>
