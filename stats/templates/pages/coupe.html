{% extends "base.html" %}

{% block title %} Coupes - {{ molecule_name }}  {% endblock %}
{% block centerText %} {{ page_title }} {% endblock %}

{% block body %}

<div class="d-flex align-items-center gap-3 m-3">
    
    <!-- Infos sur le nombre total d'observations -->
    <div>
        <small>Nombre total d'échantillons observés :</small>
        <p class="display-6 mb-0">{{ data_count }}</p>
    </div>

    <!-- Bouton pour ouvrir le panneau -->
    <button class="btn btn-primary flex-shrink-0" style="width: 200px;" 
            type="button" data-bs-toggle="offcanvas" data-bs-target="#formOffcanvas" 
            aria-controls="formOffcanvas">
        Options de visualisation
    </button>
</div>

<div class="info-box">
    <p>
        {{ presentation | safe }}
        Pour plus d'informations, vous pouvez regarder la 
        <a href="{{ url_wiki }}" target="_blank">page Wiki de cette substance</a>.
    </p>
    {% if molecule_name != "3-MMC" %}
    <p>
        "Les produits de coupe sont des substances ajoutées au principe actif d’un produit stupéfiant,
        au cours de son parcours allant de sa production à sa consommation par l’usager final, afin 
        d’augmenter le poids total du produit à la revente et éventuellement en raison de l’action pharmacologique de la ou des substances ajoutées."
        (Définition de l'OFdT)
    </p>
    {% endif %}
</div>

<!-- Offcanvas gauche -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="formOffcanvas" aria-labelledby="formOffcanvasLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="formOffcanvasLabel">Formulaire</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Fermer"></button>
    </div>
    <div class="offcanvas-body">
        {% include "components/form_coupe.html" %}
    </div>
</div>

<div class="container py-3">
    <div class="masonry-grid">

        <!-- Carte 1 : Proportion avec produits de coupe -->
        <div class="card text-center">
            <div class="card-header">
                Proportion des échantillons avec produits de coupe
            </div>
            <div class="card-body">
                {% include "components/pie_chart.html" with id="pie_chart" chart_data=data %}
                <p>
                    Le premier diagramme présente la proportion d'échantillons dans lesquels un ou plusieurs produits de coupe
                    ont été détectés.
                </p>
            </div>
        </div>

        <!-- Carte 2 : Histogramme produits de coupe -->
        <div class="card text-center">
            <div class="card-header">
                Proportion par produit de coupe
            </div>
            <div class="card-body">
                {% include "components/bar_x_chart.html" with id="bar_chart" chart_data=data %}
                <p>
                    L'histogramme suivant montre, parmi les échantillons contenant un ou plusieurs produits de coupe, 
                    la proportion pour chacun des produits de coupe.
                </p>
            </div>
        </div>

        <!-- Carte 3 : Évolution temporelle -->
        <div class="card text-center">
            <div class="card-header">
                Évolution temporelle des produits de coupe
            </div>
            <div class="card-body">
                {% include "components/area_stacked_chart.html" with id="area_chart" chart_data=data is_stacked='false' %}
                <p>
                    Parmi les échantillons coupés, voici l'évolution temporelle (par bimestre), de la présence des produits de coupe.
                </p>  
            </div>
        </div>

    </div>
</div>

{% endblock %}
