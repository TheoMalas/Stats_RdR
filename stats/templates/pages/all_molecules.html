{% extends "test.html" %}

{% load card %}

{% block title %} Analyse par type de molécule {% endblock %}

{% block explanations %} Analyse par type de molécule {% endblock %}

{% block links %} 
<ul>
    <li>Test</li>
    <li>Test</li>
</ul>

{% endblock %}

{% block filter %} 

    <div id="filter">
    <button class="btn btn-primary" style="width: 200px" 
            type="button" data-bs-toggle="offcanvas" data-bs-target="#formOffcanvas" 
            aria-controls="formOffcanvas">
        Options de visualisation
    </button>

    <p>Nombre total d'échantillons observés :</p>
    <p>{{ all_molecules_data_count }}</p>
    </div>
{% endblock %}


{% block body %} 

<!-- Offcanvas gauche -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="formOffcanvas" aria-labelledby="formOffcanvasLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="formOffcanvasLabel">Formulaire</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Fermer"></button>
    </div>
    <div class="offcanvas-body">
        {% include "components/form.html" %}
    </div>
</div>

<div class="tabs">
  <div role="tablist" aria-labelledby="tablist-1" class="manual">
    <button id="tab-1" type="button" role="tab" aria-selected="true" aria-controls="tabpanel-1">
      <span class="focus">Proportion par molécule</span>
    </button>
    <button id="tab-2" type="button" role="tab" aria-selected="false" aria-controls="tabpanel-2" tabindex="-1">
      <span class="focus">Après première consommation</span>
    </button>
    <button id="tab-3" type="button" role="tab" aria-selected="false" aria-controls="tabpanel-3" tabindex="-1">
      <span class="focus">Évolution temporelle - Nombre d'échantillons</span>
    </button>
    <button id="tab-4" type="button" role="tab" aria-selected="false" aria-controls="tabpanel-4" tabindex="-1">
      <span class="focus">Évolution temporelle - Proportion</span>
    </button>
    <button id="tab-5" type="button" role="tab" aria-selected="false" aria-controls="tabpanel-5" tabindex="-1">
      <span class="focus">Nombre d'échantillons par région</span>
    </button>
    <button id="tab-6" type="button" role="tab" aria-selected="false" aria-controls="tabpanel-6" tabindex="-1">
      <span class="focus">Échantillons par million d'habitants</span>
    </button>
  </div>

  <div id="tabpanel-1" role="tabpanel" aria-labelledby="tab-1">
    <div class="card text-center">
            <div class="card-header">
                Répartition par molécule
            </div>
            <div class="card-body">
                {% include "components/pie_chart.html" with id="pie_chart" chart_data=all_molecules_data %}
                <p class="mt-3">Le diagramme présente la proportion des échantillons en fonction de la molécule supposée.</p>
            </div>
        </div>
  </div>
  <div id="tabpanel-2" role="tabpanel" aria-labelledby="tab-2" class="is-hidden">
    <div class="card text-center">
            <div class="card-header">
                Proportion après première consommation
            </div>
            <div class="card-body">
                {% include "components/pie_chart.html" with id="pie_chart_conso" chart_data=conso_all_molecules_data %}
                <p class="mt-3">Proportion des échantillons envoyés après une première consommation.</p>
            </div>
        </div>
  </div>
  <div id="tabpanel-3" role="tabpanel" aria-labelledby="tab-3" class="is-hidden">
    <div class="card text-center">
            <div class="card-header">
                Évolution temporelle - Nombre d'échantillons
            </div>
            <div class="card-body">
                {% include "components/area_stacked_chart.html" with id="area_chart_1" chart_data=all_molecules_data is_stacked='true' %}
                <p class="mt-3">Les données sont regroupées par bimestre et montrent l'évolution en nombre d'échantillons par molécule.</p>
            </div>
        </div>
  </div>
  <div id="tabpanel-4" role="tabpanel" aria-labelledby="tab-4" class="is-hidden">
            <div class="card text-center">
            <div class="card-header">
                Évolution temporelle - Proportion
            </div>
            <div class="card-body">
                {% include "components/area_stacked_chart.html" with id="area_chart_2" chart_data=area_all_molecules_data is_stacked='true' %}
                <p class="mt-3">Les données sont regroupées par bimestre et montrent l'évolution en proportion d'échantillons par molécule.</p>
            </div>
        </div>
  </div>
  <div id="tabpanel-5" role="tabpanel" aria-labelledby="tab-5" class="is-hidden">
            <div class="card text-center">
            <div class="card-header">
                Carte - Nombre d'échantillons par région
            </div>
            <div class="card-body">
                {% include "components/map.html" with id="map_chart_abs" chart_data=map_data_abs color_data=map_data_abs_color %}
                <p class="mt-3">La carte montre le nombre d'échantillons reçus en fonction de la région d'envoi.</p>
            </div>
        </div>
  </div>
  <div id="tabpanel-6" role="tabpanel" aria-labelledby="tab-6" class="is-hidden">
             <div class="card text-center">
            <div class="card-header">
                Carte - Échantillons par million d'habitants
            </div>
            <div class="card-body">
                {% include "components/map.html" with id="map_chart_prop" chart_data=map_data_prop color_data=map_data_prop_color %}
                <p class="mt-3">Nombre d'échantillons reçus par région, rapporté à la population (par million d'habitants).</p>
            </div>
        </div>
  </div>
</div>
        
<style>
.masonry-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(600px, 1fr));
    gap: 1.5rem;
}
.card {
    min-height: 100%;
    display: flex;
    flex-direction: column;
}
.card-body {
    display: flex;
    flex-direction: column;
}
.card-header {
    font-weight: bold;
}
</style>

{% endblock %}
